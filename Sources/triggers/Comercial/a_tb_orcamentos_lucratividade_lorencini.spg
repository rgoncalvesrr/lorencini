/*============================================================================
  Empresa..: MultCont Informática
  Descrição: Atualiza Licratividade
  Autor....: Ricardo Gonçalves
  Data.....: 03/06/2008 17:29:31

  Parametro       Descrição
  ---------------------------------------------------------------------------
  out_res        | 0 - Falha / 1 - Sucesso
  ============================================================================*/
Create or Replace Function a_tb_orcamentos_lucratividade_lorencini()
Returns trigger
As
$$
Declare
   ios   	tb_orcamentos.os%type;
   irecno   tb_orcamentos.recno%type;
Begin
   -- Recupera o código da OS
   if tg_op <> 'DELETE' then
      ios := new.os;
      irecno := new.recno;
   else
      ios := old.os;
      irecno := old.recno;
   end if;

   -- Dispara cálculos da OS
   if not sys_flag('tb_orcamentos_lucratividade_lorencini', irecno) then
	   update tb_orcamentos
	      set upd_markup = true
	    where os = ios;
	end if;
	
   if tg_op != 'DELETE' then
      return new;
   else
      return old;
   end if;
End
$$
language plpgsql;